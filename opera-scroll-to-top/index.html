<html>
	<head>
		<script>
			// Creates options defaults in case user hasn't set them yet
			if (!localStorage["vertical_location"]) {
				localStorage["vertical_location"] = "bottom";
			}
			if (!localStorage["horizontal_location"]) {
				localStorage["horizontal_location"] = "right";
			}
			if (!localStorage["image_size"]) {
				localStorage["image_size"] = "48";
			}
			if (!localStorage["scrolling_speed"]) {
				localStorage["scrolling_speed"] = "1200";
			}
			if (!localStorage["visibility_behavior"]) {
				localStorage["visibility_behavior"] = "alwaysshow";
			}
			if (!localStorage["control_options"]) {
				localStorage["control_options"] = "pager";
			}
			if (!localStorage["icon_library"]) {
				localStorage["icon_library"] = "1";
			}
			if (!localStorage["user_saved_icon"]) {
				localStorage["user_saved_icon"] = "/9j/4AAQSkZJRgABAQEASABIAAD//gAUQ3JlYXRlZCB3aXRoIEdJTVAA/9sAQwACAQECAQECAgICAgICAgMFAwMDAwMGBAQDBQcGBwcHBgcHCAkLCQgICggHBwoNCgoLDAwMDAcJDg8NDA4LDAwM/9sAQwECAgIDAwMGAwMGDAgHCAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwM/8AAEQgAMAAwAwEiAAIRAQMRAf/EAB8AAAEFAQEBAQEBAAAAAAAAAAABAgMEBQYHCAkKC//EALUQAAIBAwMCBAMFBQQEAAABfQECAwAEEQUSITFBBhNRYQcicRQygZGhCCNCscEVUtHwJDNicoIJChYXGBkaJSYnKCkqNDU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6g4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2drh4uPk5ebn6Onq8fLz9PX29/j5+v/EAB8BAAMBAQEBAQEBAQEAAAAAAAABAgMEBQYHCAkKC//EALURAAIBAgQEAwQHBQQEAAECdwABAgMRBAUhMQYSQVEHYXETIjKBCBRCkaGxwQkjM1LwFWJy0QoWJDThJfEXGBkaJicoKSo1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoKDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uLj5OXm5+jp6vLz9PX29/j5+v/aAAwDAQACEQMRAD8A/J/TdPBK/LwRita10oEpxn5efypNItw5GAcg963bW33FcDGB1ps0KqaMrJgDOR1ol0vMpBUAEc10FtY7duMABc4/KmSaeefMJJ+gHGaQHJX2kgKTgcDnHWsbU7EBcYwxHFdpe2JizgFt2cE96wdWtwc8EGmmB1/wV8eJ8NPFUGo3Hhzwz4ssgR9o0zXLL7RbXKem5SskZ9GjcHpkMOD+wX7Nf7Mn7Ov7S3wQ8P8AjjRPhP4YtLPXIGd7WWJmksp43aOaFiGAYpIjgNgbgAwADAV+LGh3gRQZPlPy4+b72f8A69e8/B79ur4s/BPwRY+G/CvjG60TQtPeV7e0hsbR0RpJGlcsXiZnJZmPzE44AwAAEJo+4fip/wAEXbHxV8fm1fw9remaD4C1F99zpKQyJd6X+62lbUgMki+YA4DlNoJX5sZK/Cn/AIIvWHhT4/rrHiLWtM1/wHpsjSWmkPDI91qX7raq3TYVEAclyEL7toX5Qcji/wBjj/gsF4ou/H2leHvip/ZuqaVq1wlqNct7ZLO50+R2Cq8yRgRPCCRu2ojKCWy2Nhb+15/wWF8Tr481PQPhadN0nRtLne1/tye1S7utRdGKtJEkgMUcJIO3cjsww2UztALU+gf2mv2av2d/2aPgdr/jjW/hP4YvbXQ4VaO0iiZJL2eR1jhhVix275HUFsHau5sHbivx7+NPj5PiR4ruNRg8O+GfC1mW/caZoVj9ntrZc/d3MWkkPT5pHY9cbRxXrXxk/bk+K3xr8DXvhvxZ4yu9a0O/eOSe1msrRFLRuJEZWSJWQhlH3SM8g5BIPgmqEbTk7sE/jQNIqabcjK/y6Gug069UR7TnHAIzXFaZf7QM5xitux1IYzn8+lNoZ1dvqY2k8le/PPT0p0t/kcEjjj2rnk1XYCFbntTZdX6fMOfWkBe1C9Bz8xz9frWDql0DuwefrUl1qIAP5etYV/qe7crAAcYyRzVJAf/Z";
			}
			
			opera.extension.onmessage = function(event) {
				var requestFor = event.data.requestFor;
				if("getPrefs" == requestFor) {
					event.source.postMessage({responseFor: "getPrefs", vLoc: localStorage["vertical_location"], hLoc: localStorage["horizontal_location"], iconSize: localStorage["image_size"], scrSpeed: localStorage["scrolling_speed"], visibilityBehav: localStorage["visibility_behavior"], controlOption: localStorage["control_options"], iconLib: localStorage["icon_library"], userIcon: localStorage["user_saved_icon"]});
				}
			}
			
			var openTabFunc = function(updated) {
				opera.postError("updated: " + updated);
				if("true" == updated) {
					updated = "?updated=true";
				} else {
					updated = "";
				}
				
				// Create a tab with the specified URL
				var tab;
				
				var optionPageUrl = "pratikabu-stt-options.html" + updated;
				var tabs = opera.extension.tabs.getAll();
				for (var i = 0; i < tabs.length; i++) {
					var openTab = tabs[i];
					if(openTab.url.indexOf('widget://') != -1 && openTab.url.indexOf(optionPageUrl) != -1) {
						// page is already open
						tab = openTab;
						break;
					}
				}
				
				if(!tab) {
					tab = opera.extension.tabs.create({url: optionPageUrl});
				}
				
				// Give focus to the new tab
				tab.focus();
			}
			
			var properties = {
				disabled: false,
				title: "Scroll To Top Options",
				icon: "icons/pratikabu-stt-16.png",
				onclick: openTabFunc
			};
			
			// Create and add the button to the toolbar
			var button = opera.contexts.toolbar.createItem(properties);
			opera.contexts.toolbar.addItem(button);
			
			// open option page on initial in this version
			var currentVersion = 2;// this variable should be incremented with every update so that, add-on update message can be shown
			if(!localStorage["version_info"] || currentVersion > localStorage["version_info"]) {
				localStorage["version_info"] = currentVersion;
				openTabFunc("true");
			}
		</script>
	</head>
	<body>
	</body>
</html>
